# Writing Effective Handoff Prompts

A handoff prompt is a self-contained document that lets someone (or an agent) continue the migration in a new session with zero conversation history. It is the primary context management tool for large migrations.

## Structure

Every handoff prompt should contain these sections:

### 1. Context Block
State what project this is, where it lives, what the target Python version is, and which phases are complete with their gate status.

Example:
```
This is Phase 3 (Semantic Fixes) of a Python 2→3 migration for the "Legacy Industrial Data Platform"
at /path/to/project.

Phases completed:
- Phase 0 (Discovery): PASS — codebase analyzed, 699 Py2-isms inventoried
- Phase 1 (Foundation): PASS — future imports, test scaffolds, conversion plan
- Phase 2 (Mechanical): PASS 7/7 — all modules converted, valid Python 3 syntax
```

### 2. Key Artifacts
Reference all relevant output files by path. The next session reads these from disk.

Example:
```
Key artifacts:
- migration-analysis/state/migration-state.json — all 44 modules at Phase 2
- migration-analysis/phase-2-mechanical/gate-check-report.json — PASS 7/7
- migration-analysis/phase-1-foundation/conversion-plan.json — 9 CUs across 5 waves
```

### 3. Task List
Specific, numbered steps for the next session. Reference skills by name. Include parameters, ordering constraints, and any special handling.

Example:
```
For Phase 3, please:
1. Run py2to3-bytes-string-fixer on CU-01 (core-foundation, 6 files)
2. Run py2to3-dynamic-pattern-resolver on CU-01
3. Run the test suite for CU-01 modules
4. If tests pass, proceed to CU-03 (io-protocols, highest-risk data layer)
...
```

### 4. Risks and Blockers
Anything the next session needs to watch out for.

Example:
```
Known risks:
- database.py has silent corruption risk with str(buffer) — must use bytes() for pickle
- serial_sensor.py binary packet parsing needs byte-level validation
- Tests for Modbus hardware require mocking (no physical device available)
```

### 5. Handoff Instruction
Tell the next agent to continue the chain.

```
When finished, write a handoff prompt like this one and save it to
migration-analysis/handoff-prompts/phase4-handoff-prompt.md.
```

## Quality Checklist

A good handoff prompt passes this test: **Could someone with zero prior context pick up this prompt and continue the migration correctly?**

- [ ] States the project path and target version
- [ ] Lists all completed phases with gate status
- [ ] References all relevant output files by exact path
- [ ] Provides specific, ordered steps (not vague guidance)
- [ ] Names the skills to use
- [ ] Calls out risks, blockers, and human decisions needed
- [ ] Includes the instruction to write the next handoff prompt
- [ ] Mentions the TODO.md and state tracker for the agent to update

## Anti-Patterns

**Too vague**: "Continue with Phase 3" — doesn't tell the agent what to do or in what order.

**Too verbose**: Pasting entire output files into the prompt. The prompt should reference files by path, not include their contents.

**Missing context**: Assumes the reader knows what happened in previous sessions. Every handoff prompt must be self-contained.

**No risks called out**: The next session needs to know about landmines discovered in previous sessions.

**No continuation instruction**: If you don't tell the agent to write the next handoff prompt, the chain breaks.

## Naming Convention

Save handoff prompts to `migration-analysis/handoff-prompts/` with this naming:

- `phase0-kickoff-prompt.md` — Generated by the project initializer
- `phase1-handoff-prompt.md` — Written at the end of Phase 0
- `phase2-handoff-prompt.md` — Written at the end of Phase 1
- `phase3-handoff-prompt.md` — Written at the end of Phase 2
- `phase4-handoff-prompt.md` — Written at the end of Phase 3
- `phase5-handoff-prompt.md` — Written at the end of Phase 4

For mid-phase handoffs (when a phase takes multiple sessions):
- `phase2-wave3-handoff-prompt.md`
- `phase3-cu05-handoff-prompt.md`
